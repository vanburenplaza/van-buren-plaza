(self.webpackChunkrm_frontend=self.webpackChunkrm_frontend||[]).push([[34],{1034:function(t,i,e){"use strict";var s,o,h,n=e(349);function p(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function r(t,i){return i||(i=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(i)}}))}i.Z=(p(h={},"template-common-hotspot-widget",(0,n.f)(s||(s=r(['\n\n    <div class="common-hotspot">\n\n\t    <div class="pin"></div>\n\n    </div>\n\n'])))),p(h,"template-common-hotspot-widget-mobile-wrapper",(0,n.f)(o||(o=r(['\n\n    <div class="hotspot-fullscreen-wrapper invisible">\n        <div class="center-table">\n            <div class="center-cell">\n\n            </div>\n        </div>\n    </div>\n\n'])))),h)},1036:function(t,i,e){"use strict";var s=e(312),o=e(336),h=e.n(o),n=e(321),p=e(1034),r=e(340),a=h().View.extend({TIP_GAP:15,initialize:function(t){t&&(n.Z.bindAll(this),this.block=t.block,this.model=t.model,this.$container=t.$container,this.environment=t.environment,this.mag=t.mag,this.template=p.Z["template-common-hotspot-widget"],this.render())},render:function(){this.setElement((0,s.Z)(this.template({data:this.model}))),"viewer"===this.environment&&(this.apply_tip_container_size({width:this.model.tip_w,height:this.model.tip_h}),this.apply_tip_position(this.model)),this.$el.appendTo(this.$container)},apply_tip_container_size:function(t){t&&0===t.height&&(t.height=120),t&&this.$(".tip").css(t)},apply_tip_bg_color:function(t){this.$(".blocks-wrapper").css("background-color",r.default.getRGBA(t["tip_background-color"],t["tip_background-color-opacity"]/100))},apply_tip_border_radius:function(t){this.$(".blocks-wrapper").add(this.$(".tip")).css("border-radius",t["tip_border-radius"]+"px")},apply_tip_box_shadow:function(t){this.$(".tip").toggleClass("box-shadow",!!t["tip_box-shadow"])},apply_tip_position:function(t){var i,e=this.$(".tip"),s=t.tip_pos,o=t.tip_w,h=t.tip_h||120,n=t.w,p=t.h,r="",a="",c=this.TIP_GAP;return"top"===s?(r=-(c+h),a=n/2-o/2):"right"===s?(r=p/2-h/2,a=n+c):"bottom"===s?(r=p+c,a=n/2-o/2):"left"===s&&(r=p/2-h/2,a=-(c+o)),i={top:r,left:a},e.css(i),i},destroy:function(){this.remove()}});i.Z=a},1033:function(t,i,e){"use strict";e.r(i);var s=e(312),o=e(321),h=e(1012),n=e(340),p=e(1034),r=e(1035),a=e(1036),c=e(323),d=e(1031),l=e(1037),u=e(1038),g=h.Z.extend(r.Z.prototype).extend({DO_NOT_WAIT_FOR_PRELOAD:!0,PHONE_TIP_WIDTH:280,MOUSE_LEAVE_TIMEOUT:100,EDGE_GAP:16,events:{"click .pin":"onPinClick",mouseenter:"onMouseenter",mouseleave:"onMouseleave"},render:function(){var t;if(this.makeBox("widget-hotspot"),this.rendered=!0,this.phoneTipWrapperTemplate=p.Z["template-common-hotspot-widget-mobile-wrapper"],this.isPreview=!(!RM.constructorRouter||!RM.constructorRouter.preview),t={model:this,$container:this.$el,environment:"viewer",mag:this.page&&this.page.mag,block:null},this.hotspotWidget=new a.Z(t),this.$pin=this.$(".pin").addClass("viewer"),this.started&&this.renderTip(),"icon"===this.pin_type){if(this.$el.addClass("icon"),!this.rasterUrl)return this.widgetIsLoaded(),this;var i=(0,s.Z)("<img>");i.on("load",o.Z.bind((function(){this.$(".pin").html(i),this.widgetIsLoaded()}),this)).on("error",this.widgetIsLoaded),i.attr("src",this.raster3xUrl||this.raster2xUrl||this.rasterUrl||"")}else this.renderPinShape(),this.widgetIsLoaded();return this},renderPinShape:function(){var t,i=new Backbone.Model(this);i.id=this._id,t=this.generateShapeSVG("viewer",i,this.w,this.h),this.$pin.html(t)},renderTip:function(){this.isTipRendered||(this.$tip=(0,s.Z)('<div class="tip viewer invisible"></div>'),this.$tip.toggleClass("box-shadow",this["tip_box-shadow"]),this.$tip.css({"border-radius":this["tip_border-radius"]}),this.$blocksWrapper=(0,s.Z)('<div class="blocks-wrapper"></div>'),this.$blocksWrapper.appendTo(this.$tip),this.$blocksWrapper.css({"background-color":n.default.getRGBA(this["tip_background-color"],this["tip_background-color-opacity"]/100),"border-radius":this["tip_border-radius"]}),this.$(".common-hotspot").append(this.$tip),this.pictureData=o.Z.findWhere(this.wids||[],{type:"picture"}),this.textData=o.Z.findWhere(this.wids||[],{type:"text"}),this.hasPictureWidget=!(!this.pictureData||this.pictureData.hidden),this.hasTextWidget=!(!this.textData||this.textData.hidden),this.hasPictureWidget&&(this.pictureData.insideHotspot=!0,this.pictureWidget=new d.default(this.pictureData,this.page,this.$blocksWrapper),this.pictureWidget.isValid()?(this.pictureData.w=Math.min(this.tip_w,this.pictureData.w),this.pictureWidget.render()):(this.tip_h-=this.pictureWidget.h||0,this.textData&&(this.textData.y=0),this.pictureWidget=null,this.hasPictureWidget=!1)),this.hasTextWidget&&(this.textData.insideHotspot=!0,this.textData.hasGlobalParent=this.is_global,3===this.textData.version?this.textWidget=new u.default(this.textData,this.page,this.$blocksWrapper):this.textWidget=new l.default(this.textData,this.page,this.$blocksWrapper),this.textWidget.w=Math.min(this.tip_w,this.textWidget.w),this.textWidget.render()),this.hasPictureWidget||this.hasTextWidget?(this.$closeButton=(0,s.Z)('<div class="hotspot-phone-close"></div>'),this.$tip.append(this.$closeButton),this.isTipRendered=!0):this.$tip.remove())},updatePage:function(t){h.Z.prototype.updatePage.apply(this,arguments),this.textWidget&&this.textWidget.updatePage(t)},start:function(){return this.started=!0,this.rendered&&!this.destroyed&&this.renderTip(),this},stop:function(){return this.started=!1,this.isTipVisible&&this.hideTip(),this},applyTipPosition:function(){var t,i,e,s,h,n,p,r=this.calcDistsToPageVisibleBounds(),a=this.w,c=this.h,d=this.$tip.width(),l=this.$tip.height(),u=this.hotspotWidget.TIP_GAP,g=this.tip_pos,T=o.Z.pick(this,"w","h","tip_w","tip_h","tip_pos"),f=!1,b=!1;function m(t){var i,e,s,o;switch(t){case"top":i=r.top-c/2-u-l,s=r.bottom+c/2+u,o=r.left-d/2,e=r.right-d/2;break;case"right":i=r.top-l/2,s=r.bottom-l/2,o=r.left+a/2+u,e=r.right-a/2-u-d;break;case"bottom":i=r.bottom+c/2+u,s=r.bottom-c/2-u-l,o=r.left-d/2,e=r.right-d/2;break;case"left":i=r.top-l/2,s=r.bottom-l/2,o=r.left-a/2-u-d,e=r.right+a/2+u}return{top:i,left:o,bottom:s,right:e}}e=this.tip_pos,h=e,n=-1/0,p=!1,o.Z.each(["top","right","bottom","left"],(function(t){if(!p){var i=m(t);s=o.Z.min(i),t===e&&i[t]>0?(h=t,p=!0):s>n&&i[t]>=0&&(n=s,h=t)}})),g=h,T.tip_pos=g,i=this.hotspotWidget.apply_tip_position(T),t=m(g),o.Z.each(t,function(t,e){if(t<0)switch(e){case"top":i.top-=t-this.EDGE_GAP,f=!0;break;case"bottom":f||(i.top+=t-this.EDGE_GAP);break;case"left":i.left-=t-this.EDGE_GAP,b=!0;break;case"right":b||(i.left+=t-this.EDGE_GAP)}}.bind(this)),this.$tip.css(i)},adjustPictureSize:function(){var t,i=this.tip_w/this.PHONE_TIP_WIDTH;this.pictureWidget&&(t=this.isPhone()?{width:this.PHONE_TIP_WIDTH,height:this.pictureData.h/i}:{width:this.pictureData.w,height:this.pictureData.h},this.pictureWidget.$el.css(t))},onPinClick:function(){this.isHoverable()||(this.isTipVisible?this.hideTip():this.isTipRendered&&this.showTip(),RM.analytics&&this.isTipVisible&&RM.analytics.sendEvent("Hotspot Click"))},onMouseenter:function(){this.isHoverable()&&this.isTipRendered&&(clearTimeout(this.mouseLeaveTimeout),this.isTipVisible||this.showTip(),RM.analytics&&RM.analytics.sendEvent("Hotspot Hover"))},onMouseleave:function(){this.isHoverable()&&(clearTimeout(this.mouseLeaveTimeout),this.mouseLeaveTimeout=setTimeout(function(){this.hideTip()}.bind(this),this.MOUSE_LEAVE_TIMEOUT))},showTip:function(){this.isTipRendered&&(this.adjustPictureSize(),this.isPhone()?(this.$phoneTipWrapper=this.$phoneTipWrapper||(0,s.Z)(this.phoneTipWrapperTemplate()),this.$phoneTipWrapper.toggleClass("preview",this.isPreview),this.$phoneTipWrapper.detach().appendTo(this.isPreview?".mag-pages-container":"body"),this.$phoneTipWrapper.on("touchstart",this.onTipTouchStart),this.$phoneTipWrapper.on("touchmove",this.onTipTouchMove),this.$tipParent=this.$tip.parent(),this.$tip.detach().appendTo(this.$phoneTipWrapper.find(".center-cell")),o.Z.defer(function(){this.$phoneTipWrapper.removeClass("invisible")}.bind(this)),this.$phoneTipWrapper.on("click",function(t){(0,s.Z)(t.target).closest(".tip").is(this.$tip)||(this.hideTip(),this.$phoneTipWrapper.off())}.bind(this)),this.$closeButton.on("click",this.onCloseButtonClick)):(this.hotspotWidget.apply_tip_container_size({width:this.tip_w,height:this.tip_h}),this.applyTipPosition(),this.$tip.removeClass("invisible"),this.BringToTopZ(),this.page.mag.router.$mags_container.on("mousedown touchstart",this.onGlobalMouseDown),this.isHoverable()||(0,s.Z)("body").on("keydown",this.onBodyKeyDown)),this.listenTo(this.page.mag,"change:viewport",this.onMagViewportBeforeChange),this.isTipVisible=!0)},hideTip:function(){this.isTipVisible&&(this.isTipVisible=!1,clearTimeout(this.mouseLeaveTimeout),this.isPhone()?(this.$phoneTipWrapper.addClass("invisible"),this.$phoneTipWrapper.off("touchstart",this.onTipTouchStart),this.$phoneTipWrapper.off("touchmove",this.onTipTouchMove),o.Z.delay(function(){this.$tip.detach().appendTo(this.$tipParent),this.$phoneTipWrapper&&this.$phoneTipWrapper.detach()}.bind(this),200)):(this.$tip.addClass("invisible"),this.BackToNormalZ(),(0,s.Z)("body").off("keydown",this.onBodyKeyDown)),this.stopListening(this.page.mag,"change:viewport"))},onTipTouchStart:function(t){this.tipScrollY=t.originalEvent.touches.item(0).clientY},onTipTouchMove:function(t){t.stopPropagation();var i=(0,s.Z)(t.currentTarget),e=this.tipScrollY-t.originalEvent.touches.item(0).clientY;(e<0&&i.scrollTop()<=0||e>0&&i.scrollTop()+i.height()>=i[0].scrollHeight)&&t.preventDefault(),this.tipScrollY=t.originalEvent.touches.item(0).clientY},onCloseButtonClick:function(){this.$closeButton.off("click",this.onCloseButtonClick),this.hideTip()},onMagViewportBeforeChange:function(){this.hideTip()},onGlobalMouseDown:function(t){var i=(0,s.Z)(t.target),e=i.closest(".pin"),o=i.closest(".tip");e.is(this.$pin)||o.is(this.$tip)||(this.page.mag.router.$mags_container.off("mousedown touchstart",this.onGlobalMouseDown),this.hideTip())},isPhone:function(){return c.Z.isPhone||this.isPreview&&"phone_portrait"===this.page.mag.viewport},isHoverable:function(){return"hover"===this.tip_show_on&&c.Z.isDesktop&&!this.isPhone()&&"tablet_portrait"!==this.page.mag.viewport},onBodyKeyDown:function(t){t.keyCode===s.Z.keycodes.esc&&this.hideTip()},destroy:function(){return this.hotspotWidget&&this.hotspotWidget.destroy(),this.hotspotWidget=null,h.Z.prototype.destroy.apply(this,arguments)}});i.default=g}}]);